---
title: allocateNonGCMemory
description: Asserts that a callable allocates non-GC memory (malloc, etc.)
---

Asserts that a callable allocates memory outside of the garbage collector during its execution. This includes manual memory allocation via `malloc`, `core.stdc.stdlib`, or similar mechanisms.

:::caution[Platform Limitations]
Non-GC memory tracking only works reliably on Linux using `mallinfo()`. On Linux, small runtime allocations may be detected even when the tested code doesn't allocate - use this assertion primarily to detect intentional large allocations (e.g., > 1MB). macOS and Windows don't have reliable non-GC memory delta tracking.
:::

## Examples

```d
import core.stdc.stdlib : malloc, free;

expect({
    // Allocate a large block to ensure reliable detection
    auto ptr = malloc(10 * 1024 * 1024);  // 10 MB
    free(ptr);
}).to.allocateNonGCMemory();
```

### With Negation

```d
expect({
    int x = 42;  // no allocation
    return x;
}).to.not.allocateNonGCMemory();
```

### What Failures Look Like

```d
expect({
    int x = 42;
    return x;
}).to.allocateNonGCMemory();
```

```
ASSERTION FAILED: delegate should allocate non-GC memory.
OPERATION: allocateNonGCMemory

  ACTUAL: no non-GC allocations
EXPECTED: non-GC allocations
```

## See Also

- [allocateGCMemory](/api/callable/gcMemory/) - Assert GC memory allocation
